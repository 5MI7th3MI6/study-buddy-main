## Getting Started

First, run the development server:

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

Setup your environment variables in `.env.local` file. You can use `.env.local.example` as a reference.

Setup a database on [Supabase](https://supabase.io/).
Run the following SQL to create the table:

## database tables

create table
public.achievements (
id bigint generated always as identity,
name text not null,
description text null,
max_value integer null,
type text null,
constraint achievements_pkey primary key (id)
) tablespace pg_default;

create table
public.tasks (
id bigint generated by default as identity,
created_at timestamp with time zone not null default now(),
date date not null,
"startTime" time without time zone not null,
"endTime" time without time zone null,
details character varying null,
"associatedClass" character varying null,
type character varying not null,
task_name character varying not null,
user_id uuid not null,
constraint tasks_pkey primary key (id),
constraint tasks_user_id_fkey foreign key (user_id) references auth.users (id) on delete cascade
) tablespace pg_default;

create table
public.userachievements (
id serial,
user_id uuid null,
achievement_id integer null,
progress numeric(5, 2) null default 0.0,
achieved boolean null default false,
constraint userachievements_pkey primary key (id),
constraint unique_user_achievement unique (user_id, achievement_id),
constraint userachievements_achievement_id_fkey foreign key (achievement_id) references achievements (id) on delete cascade,
constraint userachievements_user_id_fkey foreign key (user_id) references auth.users (id) on delete cascade
) tablespace pg_default;

create table
public."userCourses" (
created_at timestamp with time zone not null default now(),
user_id uuid not null default auth.uid (),
course_id uuid not null default gen_random_uuid (),
constraint userCourses_pkey primary key (user_id, course_id),
constraint userCourses_course_id_fkey foreign key (course_id) references courses (id) on update cascade on delete cascade,
constraint userCourses_user_id_fkey foreign key (user_id) references "user" (id) on update cascade on delete cascade
) tablespace pg_default;

create table
public.user (
id uuid not null default auth.uid (),
created_at timestamp with time zone not null default now(),
last_seen timestamp with time zone null,
login_streak bigint null,
last_updated timestamp with time zone null,
username text not null default 'anon'::text,
avatar text null,
constraint user_pkey primary key (id),
constraint user_id_fkey foreign key (id) references auth.users (id) on delete cascade
) tablespace pg_default;

create table
public.courses (
id uuid not null default gen_random_uuid (),
created_at timestamp with time zone not null default now(),
name character varying null,
description text null,
constraint courses_pkey primary key (id)
) tablespace pg_default;

create table
public."courseMessages" (
id uuid not null default gen_random_uuid (),
created_at timestamp with time zone not null default now(),
course_id uuid null,
user_id uuid null,
message text null,
constraint courseMessages_pkey primary key (id),
constraint courseMessages_course_id_fkey foreign key (course_id) references courses (id) on update cascade on delete cascade,
constraint courseMessages_user_id_fkey foreign key (user_id) references "user" (id) on update cascade on delete cascade
) tablespace pg_default;

## Row level security

-   these are the rls policies you will need to activate for each table for the project to work. This is not sql code to run but
    a guide on how the policies should be set up.

alter policy "Enable read access for all users"
on "public"."achievements"
to authenticated
using (
true
);

alter policy "Enable read access for all users"
on "public"."courseMessages"
to authenticated
using (
true
);

alter policy "send_message"
on "public"."courseMessages"
to authenticated
with check (
true
);

alter policy "Enable read access for all users"
on "public"."courses"
to authenticated
using (
true
);

alter policy "Enable delete for users based on user_id"
on "public"."tasks"
to authenticated
using (
(( SELECT auth.uid() AS uid) = user_id)
);

alter policy "Enable insert for authenticated users only"
on "public"."tasks"
to authenticated
with check (
true
);

alter policy "Enable read access for all users"
on "public"."tasks"
to authenticated
using (
true
);

alter policy "Enable updated access for all users"
on "public"."tasks"
to authenticated
using (
true
);

alter policy "Enable insert access for all users"
on "public"."user"
to authenticated
with check (
true
);

alter policy "Enable read access for all users"
on "public"."user"
to public
using (
true
);

alter policy "Enable read update for all users"
on "public"."user"
to public
using (
true
);

INSERT Enable insert for authenticated users only
SELECT Enable read access for all users
UPDATE Enable update access for all users

DELETE delete content
INSERT Enable insert for authenticated users only
SELECT Enable read access for all users
